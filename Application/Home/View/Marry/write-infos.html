<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>免费发布--雷州半岛网站</title>
    <include file='Public:header' />
    <div class="container songti font12 wrap-nav">
        <include file='Public:daohang' />
    </div>
    <section class="container">
        <include file='Public:protocol' />
        <div class="write-menu">
            <ul>
                <li class="bluebg-active">店铺面</li>
                <span></span>
                <li>喜庆</li>
                <span></span>
                <li>汽车</li>
                <span></span>
                <li>相亲</li>
                <span></span>
                <li>房子</li>
                <span></span>
                <li>电器</li>
                <span></span>
                <li>海鲜</li>
                <span></span>
                <li>酒店/娱乐</li>
                <span></span>
                <li>美食</li>
                <span></span>
                <li>农业</li>
                <span></span>
                <li>家具</li>
                <span></span>
                <li>七星彩梦册</li>
                <span></span>
                <li>其他</li>
                <span></span>
            </ul>
        </div>
        <div class="register write-info songti font12">
            <form action="{:U('Store/storeAdd')}" name="form0" id="defaultForm" id="form0" role="form" class="form-horizontal" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="name" class="control-label">所在地区</label>
                    <select name="area">
                        <assign name="lz_area" value="$Think.config.lz_area"/>
                        <volist name="lz_area" id="lz_areas">
                            <option value="{$lz_areas}">{$lz_areas}</option>
                        </volist>
                    </select>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">所属分类</label>
                    <select name="category" id="bigname">
                        <volist name="list" id="list">
                            <option value="{$list.column_name}">{$list.column_name}</option>
                        </volist>
                    </select>
                    <select name="sub_cateid" id="smallname"></select>
                    <script>
                        $(function(){
                            function getSelectVal(){
                                $.getJSON("{:U('Store/change')}",{bigname:$("#bigname").val()},function(json){
                                    var smallname = $("#smallname");
                                    $("option",smallname).remove(); //清空原有的选项
                                    $.each(json,function(index,array){
                                        var option = "<option value='"+array['column_name']+"'>"+array['column_name']+"</option>";
                                        smallname.append(option);
                                    });
                                });
                            }
                            getSelectVal();
                            $("#bigname").change(function(){
                                getSelectVal();
                            });
                        });
                    </script>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label"><span class="red">* </span>标题</label>
                    <input type="text" class="form-control wid512" name="title" placeholder="请输入标题"/>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label"><span class="red">* </span>店铺规模</label>
                    <input type="text" class="form-control wid120" name="size"/>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">发布身份</label>
                    <select name="identity">
                        <assign name="room_type" value="$Think.config.room_type"/>
                        <volist name="room_type" id="type">
                            <option value="{$type}">{$type}</option>
                        </volist>
                    </select>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">价格</label>
                    <input type="text" class="form-control wid120" name="price"/>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">联系人</label>
                    <input type="text" class="form-control wid120" name="linker"/>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">电话</label>
                    <input type="text" class="form-control wid250" name="phone"/>
                </div>
                <div class="form-group text-area">
                    <label for="name" class="control-label">描述</label>
                    <div>
                        <textarea name="describe"  class="form-control wid512" cols="80" rows="4"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">店面地址</label>
                    <input type="text" class="form-control wid512" name="address"/>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">封面图片</label>
                    <img class="pull-left" src="__PUBLIC__/assets/img/no_img.jpg" width="210" height="160" id="img0" >
                    <span class="pull-left text-muted write-photo">图片仅支持格式：JPG|JPEG|GIF|PNG 先用ps处理再上传<br> 大小：210 * 160像素 <= 15K <p>
                        <a href="javascript:;" class="btn btn-primary file">
                            <input type="file" name="file0" id="file0" multiple="multiple"/>
                            选择上传图片
                        </a>
                    </p></span>
                </div>
                <div class="form-group">
                    <label for="name" class="control-label">&nbsp;</label>
                    <input type="checkbox" name="" id="" checked="checked"/> 我已阅读并同意 <span class="songti">&lt;&lt;</span><a href="">协议</a><span class="songti">&gt;&gt;</span>
                </div>
                <div class="form-group" id="write-submit">
                    <label for="name" class="control-label"></label>
                    <input type="submit" class="btn btn-warning wid120" value="确认发布"/>
                </div>
            </form>
        </div>
    </section>
    <include file='Public:footer' />
    </body>
</html>
<script>
    $("#file0").change(function(){
        var objUrl = getObjectURL(this.files[0]) ;
        console.log("objUrl = "+objUrl) ;
        if (objUrl) {
            $("#img0").attr("src", objUrl) ;
        }
    }) ;
    //建立一個可存取到該file的url
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            $("#news_flag_vap").attr("checked", true);
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            $("#news_flag_vap").attr("checked", true);
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            $("#news_flag_vap").attr("checked", true);
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
</script>
<script type="text/javascript">
    $(function() {
        function randomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        };
        $('#captchaOperation').html([randomNumber(1, 100), '+', randomNumber(1, 200), '='].join(' '));
        $('#defaultForm').bootstrapValidator({
            message: '此值无效',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                title: {
                    message: '请输入有效的标题',
                    validators: {
                        notEmpty: {
                            message: '标题不能为空'
                        },
                        stringLength: {
                            min: 5,
                            max: 80,
                            message: '标题在5-80个字符'
                        },
                        remote: {
                            url: '{:U("Store/checkTitle")}',
                            message: '标题曾经提交过了，换个厉害的新标题哦！'
                        },
                        regexp: {
                            regexp: /^[,.()+\!\[\]\:\/\ A-Za-z0-9\u4e00-\u9fa5_-]+$/,
                            message: '请不要输入非法字符'
                        }
                    }
                },
                size: {
                    validators: {
                        notEmpty: {
                            message: '店铺规模不能为空'
                        },
                        regexp: {
                            regexp: /^[0-9]{2,}$/,
                            message: '只能填写2位整数字'
                        }
                    }
                },
                price: {
                    validators: {
                        notEmpty: {
                            message: '价格不能为空'
                        }
                    }
                },
                linker: {
                    message: '请输入有效的联系人',
                    validators: {
                        notEmpty: {
                            message: '联系人不能为空'
                        },
                        stringLength: {
                            min: 2,
                            max: 4,
                            message: '联系人在2-4个字符'
                        },
                        regexp: {
                            regexp: /^[\u4e00-\u9fa5_]+$/,
                            message: '联系人只能由汉字组成'
                        }
                    }
                },
                phone: {
                    validators: {
                        notEmpty: {
                            message: '手机不能为空'
                        },
                        regexp: {
                            regexp: /^0?1[3|4|5|8][0-9]\d{8}$/,
                            message: '手机号码不正确'
                        }
                    }
                },
                address: {
                    validators: {
                        notEmpty: {
                            message: '详细地址不能为空'
                        }
                    }
                },
                describe: {
                    message: '请输入有效的描述内容',
                    validators: {
                        notEmpty: {
                            message: '描述内容不能为空'
                        },
                        stringLength: {
                            min: 10,
                            max: 200,
                            message: '描述内容在10-200个字符'
                        }
                    }
                }
            }
        });
    });
</script>